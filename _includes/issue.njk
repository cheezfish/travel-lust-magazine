---
layout: 'layout.njk'
---
<article class="issue-viewer">
    <h2>{{ title }}</h2>
    <p><em>Published on: {{ date | readableDate }}</em></p>

    <div class="pdf-viewer">
        <!-- PDF.js viewer (works best with Cloudflare Pages) -->
        <iframe 
            src="https://mozilla.github.io/pdf.js/web/viewer.html?file=https%3A//travellustmagazine.com{{ pdf_file | url_encode }}"
            width="100%" 
            height="800px"
            style="border: 1px solid #ccc;"
            sandbox="allow-scripts allow-same-origin allow-popups allow-forms"
            loading="lazy">
            <p>PDF viewer loading... <a href="{{ pdf_file }}" target="_blank">Click here if it doesn't load</a></p>
        </iframe>
    </div>

    <div class="pdf-controls" style="margin: 20px 0; text-align: center;">
        <a href="{{ pdf_file }}" target="_blank" class="btn primary">üìñ Open PDF</a>
        <a href="{{ pdf_file }}" download class="btn secondary">‚¨áÔ∏è Download</a>
        <button onclick="refreshViewer()" class="btn secondary">üîÑ Refresh Viewer</button>
    </div>

    <!-- Alternative viewer (fallback) -->
    <div id="alternative-viewer" style="display: none;">
        <h4>Alternative PDF Viewer</h4>
        <embed src="{{ pdf_file }}" type="application/pdf" width="100%" height="600px" style="border: 1px solid #ccc;">
    </div>

    <hr>
    <h3>Comments & Thoughts</h3>
    <p>We'd love to hear what you think! Visit our <a href="/submissions/">submissions page</a> to send us a message.</p>
</article>

<style>
.pdf-viewer {
    width: 100%;
    margin: 20px 0;
    position: relative;
}

.pdf-controls {
    display: flex;
    justify-content: center;
    gap: 10px;
    flex-wrap: wrap;
}

.btn {
    display: inline-block;
    padding: 12px 24px;
    text-decoration: none;
    border-radius: 6px;
    font-weight: 500;
    border: none;
    cursor: pointer;
    transition: all 0.2s ease;
}

.btn.primary {
    background: #2563eb;
    color: white;
}

.btn.primary:hover {
    background: #1d4ed8;
}

.btn.secondary {
    background: #64748b;
    color: white;
}

.btn.secondary:hover {
    background: #475569;
}

@media (max-width: 768px) {
    .pdf-viewer iframe,
    .pdf-viewer embed {
        height: 500px;
    }
    
    .pdf-controls {
        flex-direction: column;
        align-items: center;
    }
    
    .btn {
        width: 200px;
        margin: 5px 0;
    }
}

/* Loading indicator */
.pdf-viewer::before {
    content: "Loading PDF viewer...";
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(255, 255, 255, 0.9);
    padding: 20px;
    border-radius: 4px;
    z-index: 1;
    animation: fadeOut 3s forwards;
}

@keyframes fadeOut {
    0% { opacity: 1; }
    90% { opacity: 1; }
    100% { opacity: 0; pointer-events: none; }
}
</style>

<script>
function refreshViewer() {
    const iframe = document.querySelector('.pdf-viewer iframe');
    const currentSrc = iframe.src;
    iframe.src = '';
    setTimeout(() => {
        iframe.src = currentSrc;
    }, 100);
}

// Fallback mechanism
document.addEventListener('DOMContentLoaded', function() {
    const iframe = document.querySelector('.pdf-viewer iframe');
    const altViewer = document.getElementById('alternative-viewer');
    
    // Show alternative viewer if main viewer fails
    iframe.addEventListener('error', function() {
        console.log('PDF.js viewer failed, showing alternative');
        altViewer.style.display = 'block';
    });
    
    // Check if PDF loads after 5 seconds
    setTimeout(function() {
        try {
            // Simple connectivity test
            if (!iframe.contentDocument && !iframe.contentWindow) {
                console.log('PDF viewer may have failed to load');
                // Could show a message or switch to alternative
            }
        } catch (e) {
            // Cross-origin restrictions - this is actually normal for PDF.js
        }
    }, 5000);
});
</script>